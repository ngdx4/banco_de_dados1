PRAGMA foreing_keys = true; --ativa o foragekeys no SQLite

-- script DDL
--Dropar tabela do mais dependente ao menos dependente
DROP TABLE ESTACIONA;
DROP TABLE MENSALISTA;
DROP TABLE AVULSO;
DROP TABLE CLIENTE;
DROP TABLE VAGA;

-- Criar as tabelas comecando pelas chave primaria
CREATE TABLE VAGA (
  NUMERO INT NOT NULL,
  STATUS CHAR(1) CHECK (STATUS IN ('O', 'L')),
  PRIMARY KEY (NUMERO)
);

CREATE TABLE CLIENTE (
  CODIGO INT NOT NULL,
  PRIMARY KEY (CODIGO)
);

CREATE TABLE MENSALISTA (
  CODIGO INT NOT NULL,
  NOME VARCHAR(100) NOT NULL,
  PRIMARY KEY (CODIGO),
  FOREIGN KEY (CODIGO) REFERENCES CLIENTE(CODIGO)
);

CREATE TABLE AVULSO (
  CODIGO INT NOT NULL,
  PLACA CHAR(8) NOT NULL,
  MARCA VARCHAR(20),
  COR VARCHAR(20),
  PRIMARY KEY (CODIGO),
  FOREIGN KEY (CODIGO) REFERENCES CLIENTE(CODIGO)
);

CREATE TABLE ESTACIONA (
  ID INTEGER,
  ENTRADA TIMESTAMP DEFAULT CURRENT_DATE,
  SAIDA TIMESTAMP,
  VAGA INT NOT NULL,
  CLIENTE INT NOT NULL,
  VALOR NUMERIC(10,2) DEFAULT 0,
  PRIMARY KEY(ID AUTOINCREMENT),
  FOREIGN KEY (VAGA) REFERENcES VAGA(NUMERO),
  FOREIGN KEY (CLIENTE) REFERENcES CLIENTE(CODIGO)
);
-- fim script DDL

-- script DML 
INSERT INTO VAGA(NUMERO, STATUS) VALUES(100, 'L');
INSERT INTO VAGA(NUMERO, STATUS) VALUES(200, 'O');
INSERT INTO VAGA(NUMERO, STATUS) VALUES(300, 'L');

INSERT INTO CLIENTE VALUES(1);
INSERT INTO CLIENTE VALUES(2);
INSERT INTO CLIENTE VALUES(3);
INSERT INTO CLIENTE VALUES(4);

INSERT INTO MENSALISTA(CODIGO, NOME) VALUES(1,'JOSE');
INSERT INTO MENSALISTA(CODIGO, NOME) VALUES(4,'MARIA');                           
INSERT INTO AVULSO(CODIGO, PLACA, MARCA, COR) VALUES(2,'AAA-1234','FIAT','BRANCO');
INSERT INTO AVULSO(CODIGO, PLACA, MARCA, COR) VALUES(3,'BBB-6789','Vw','AZUL');

INSERT INTO ESTACIONA(ENTRADA, SAIDA, VAGA, CLIENTE, VALOR) VALUES('2024-11-05 09:00:00', NULL, 100, 1, 25);
INSERT INTO ESTACIONA(VAGA,CLIENTE) VALUES(200,2);
--UPDATE VAGA SET STATUS = 'O'; --altera todos os status;
--UPDATE VAGA SET STATUS = 'O' WHERE NUMERO=300; --altera um em especifico

--DELETE * FROM VAGA; -- Limpa todos os dados de VAGA
--DELETE FROM VAGA WHERE NUMERO=200;


--fim script DML
-- DQL
SELECT NUMERO, STATUS from VAGA; --Select Ã© DQL, linguagem de consulta
SELECT * FROM VAGA;
SELECT * FROM CLIENTE;
SELECT * FROM MENSALISTA; 
SELECT * FROM AVULSO;
SELECT * FROM ESTACIONA;


select ESTACIONA.ENTRADA,ESTACIONA.VAGA,AVULSO.PLACA
FROM ESTACIONA
INNER JOIN AVULSO ON
AVULSO.CODIGO = ESTACIONA.CLIENTE
